<? include('../../../inc/config.php'); 

$liste_code = array(
'07000224',
'07003330',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04002567',
'04008969',
'07000210',
'07001188',
'07002894',
'01006399',
'04000776',
'04002599',
'09000104',
'07003082',
'07000749',
'04005480',
'07000751',
'04005907',
'07002801',
'07003109',
'07002771',
'07002117',
'07000960',
'04007962',
'01002025',
'04006019',
'07000722',
'07002957',
'07002908',
'07003331',
'07000253',
'07002959',
'07003028',
'07002381',
'12000068',
'07003094',
'07000643',
'04008496',
'01000492',
'01000494',
'01020311',
'04002169',
'07000219',
'07002781',
'01012013',
'07000268',
'09000267',
'07003220',
'07003088',
'07003004',
'07003208',
'07003218',
'07002813',
'07002928',
'04005366',
'07003080',
'07002115',
'07002983',
'07000228',
'04002759',
'01002021',
'07000548',
'07001186',
'07000058',
'04001624',
'07000552',
'04006236',
'04009675',
'04007801',
'04002183',
'07002153',
'07000170',
'04001080',
'07000099',
'07000211',
'07000329',
'01002269',
'12000232',
'07002791',
'07003007',
'04013535',
'01002017',
'01014390',
'01020312',
'07002790',
'10002337',
'10002606',
'10002051',
'01001264',
'07002034',
'01020173',
'01000674',
'01000489',
'07001344',
'07002039',
'04006235',
'04014020',
'04003875',
'07002176',
'04005362',
'07002800',
'04014018',
'07000631',
'07002900',
'04005361',
'04004014',
'07000319',
'07000088',
'07002806',
'01000675',
'07003097',
'07000647',
'01002967',
'07002805',
'07000213',
'07001135',
'01010347',
'12000209',
'07000217',
'07002802',
'07002033',
'01006339',
'07000358',
'01014295',
'07000349',
'04006556',
'04001588',
'07003328',
'04003642',
'01003657',
'01000485',
'07002895',
'07001150',
'01020172',
'07002020',
'07002777',
'04010892',
'04001180',
'01000464',
'01003615',
'01008470',
'09000290',
'04001083',
'07003219',
'12000070',
'07000947',
'07000698',
'04005365',
'09000129',
'01002583',
'04007517',
'04004862',
'04003687',
'04020363',
'07002564',
'07002698',
'04004095',
'04013192',
'07000330',
'04005603',
'07000793',
'01020169',
'04005364',
'04005413',
'04002785',
'01003122',
'07002263',
'10000837',
'01002586',
'04003682',
'04005281',
'07002498',
'07000907',
'02005520',
'07002213',
'07000440',
'07001105',
'07000347',
'07000612',
'01002194',
'04001936',
'07002254',
'01005579',
'01006737',
'04008459',
'04007590',
'07001891',
'07002259',
'01015234',
'04003654',
'07000764',
'12000022',
'07000167',
'07001982',
'04002317',
'04003263',
'04001204',
'04003656',
'07000350',
'04017223',
'02004922',
'01002670',
'07002585',
'02003871',
'04009709',
'07000371',
'09000377',
'07001114',
'04003650',
'07000299',
'04001051',
'09000438',
'07002418',
'07000561',
'04025235',
'01001888',
'01006199',
'09000234',
'09000307',
'04006567',
'04003646',
'04004325',
'07001122',
'01018306',
'04006853',
'07002003',
'07000370',
'04006570',
'01006982',
'04013008',
'09000303',
'12000104',
'07001123',
'07002586',
'01013401',
'07000916',
'12000250',
'04001938',
'07000933',
'01018293',
'01018301',
'01000294',
'04005868',
'02001927',
'01018296',
'01018642',
'01015232',
'07003003',
'10001995',
'07003008',
'09000306',
);

print "CODE_ARTICLE;DESIGNA;REF_FOUR;QTE_REFLEX;EMPLACE\n";

foreach ($liste_code as $code_article) {

$sql = <<<EOT
select
GEI.GECART as CODE_ARTICLE,
ARTICLE.ARLART as DESIGNATION1,
ARTICLE.ARMDAR as REF_FOURNISSEUR,
GEI.GEQGEI as QTE_REFLEX,
(select VLCTVL from ${REFLEX_BASE}.HLARVLP where VLCART=GEI.GECART and VLCVLA=10) as CODE_UNITE,
(select TVLTVL from ${REFLEX_BASE}.HLARVLP,${REFLEX_BASE}.HLTYVLP where VLCART=GEI.GECART and VLCVLA=10 and VLCTVL=TVCTVL) as LIBELLE_UNITE,
(EMC1EM + ' ' + EMC2EM + ' '+ EMC3EM + ' ' + EMC4EM + ' ' + EMC5EM) as EMPLACEMENT,
SUPPORT.SUNSUP as NUMERO_SUPPORT,
VL.VLCFPR as FAMILLE_PREPARATION,
QUALITE.QACQAL as CODE_QUALITE,
QUALITE.QALQAL as LIBELLE_QUALITE,
ETAT_SUPPORT.ESL3ES as CODE_ETAT_SUPPORT,
ETAT_SUPPORT.ESLESU as LIBELLE_ETAT_SUPPORT,
(CAST(GEJREG as VARCHAR(2))+ '/' + CAST(GEMREG as VARCHAR(2)) + '/' + CAST(GESREG as VARCHAR(2)) + CAST(GEAREG as VARCHAR(2))) as DATE_RECEPTION
	from		${REFLEX_BASE}.HLGEINP GEI
	left join	${REFLEX_BASE}.HLSUPPP SUPPORT
		on GEI.GENSUP=SUPPORT.SUNSUP
	left join  	${REFLEX_BASE}.HLEMPLP EMPLACEMENT
		on SUPPORT.SUNEMP=EMPLACEMENT.EMNEMP
	left join  	${REFLEX_BASE}.HLARVLP VL
		on GEI.GECART=VL.VLCART
	left join  	${REFLEX_BASE}.HLARTIP ARTICLE
		on GEI.GECART=ARTICLE.ARCART
	left join  	${REFLEX_BASE}.HLETSUP ETAT_SUPPORT
		on SUPPORT.SUCESU=ETAT_SUPPORT.ESCESU
	left join  	${REFLEX_BASE}.HLQUALP QUALITE
		on GEI.GECQAL=QUALITE.QACQAL
where
		GEI.GECTST='200'		-- obligatoire pour le stock réel
	and GEI.GECART='$code_article'			-- code article
	and VL.VLCVLA=30			-- VL 10
order by CODE_QUALITE ASC, EMPLACEMENT ASC
EOT;
	$reflex  = odbc_connect(REFLEX_DSN,REFLEX_USER,REFLEX_PASS) or die("Impossible de se connecter à Reflex via ODBC ($REFLEX_DSN)");
	$res = odbc_exec($reflex,$sql)  or die("Impossible de lancer la modification de ligne : <br/>$sql");
	$i=0;
	$qte = 0;
	while($row = odbc_fetch_array($res)) {

		print "$code_article;$row[DESIGNATION1];$row[REF_FOURNISSEUR];$row[QTE_REFLEX];$row[EMPLACEMENT]\n";
	}
}
odbc_close($reflex);

?>